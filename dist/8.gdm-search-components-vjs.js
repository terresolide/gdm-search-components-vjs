(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{246:function(e,t,s){var n=s(335);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,s(3).default)("1ebebe43",n,!0,{})},334:function(e,t,s){"use strict";s(246)},335:function(e,t,s){(t=s(2)(!1)).push([e.i,'\n.job-header {\n  display:flex;\n}\n.job-header > div {\n  padding: 0 10px 0 0;\n  flex-grow:1;\n}\n.job-header h2,\n.job-content h1 {\n  color:black;\n  font-size:20px;\n  font-family: "Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif;\n}\n.job-content h1 {\n  font-size: 24px;\n}\n.user-search {\n   margin:auto;\n   margin-bottom:20px;\n   text-align: left;\n   display: inline-block;\n   background: #F5f5f5;\n   margin-bottom: 40px;\n   margin-left: calc(50% - 225px);\n   padding: 10px;\n   border: 1px solid grey;\n   border-radius: 5px;\n}\n.user-search-large {\n   margin-left:5px;\n}\n.user-search > div {\n   display: inline-block;\n}\n.user-search label {\n   margin-left:10px;\n   font-weight: 700;\n}\nul.menu-content {\n  border-bottom: 1px solid #adadad;\n}\nul.menu-content li {\n  display: inline-block;\n   min-width: 50px;\n  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n  border: 1px solid #adadad;\n  border-bottom: none;\n  text-align: center;\n  color: black;\n  height: 30px;\n  vertical-align: middle;\n  margin: 0;\n  background: #efefef;\n  cursor: pointer;\n}\nul.menu-content li{\n    text-transform: capitalize;\n    vertical-align: middle;\n    font-size: 1.1rem;\n    height: 30px;\n    min-width:50px;\n    color:black;\n    padding: 5px 10px 0 10px;\n    text-decoration: none;\n    display:inline-block;\n}\nul.menu-content li:hover {\n  color:#b8412c;\n}\nul.menu-content li.selected {\n  background:white;\n  color:#b8412c;\n}\nul.menu-content li.isDisabled {\n  pointer-events: none;\n  color:grey;\n}\n',""]),e.exports=t},341:function(e,t,s){"use strict";s.r(t);var n=s(330),r=s(331),i=s.n(r),a=s(332),o=s.n(a),c=s(333),u=s.n(c),l=s(0),d=s.n(l);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"object"===v(n)&&(i()(n),u()(n),o()(n));var p={name:"GdmStat",props:{appUrl:{type:String,default:null}},computed:{selectedServices:function(){return""!==this.selectedGroup?this.groups[this.selectedGroup]:this.services},selectedName:function(){var e=this;if(""!==this.selectedService){var t=this.services.find((function(t){return t.id===e.selectedService}));if(t)return"Résultats pour le service "+t.name}return""!==this.selectedGroup?"Résultats pour les services "+this.selectedGroup:"Résultats pour tous les services"}},data:function(){return{startDate:null,endDate:null,by:"day",mode:"connection",sessions:{days:[],months:[],years:[]},newUsers:{days:{},months:{},years:{}},process:{days:{},months:{},years:{}},serviceUsers:[],userTypes:[],days:[],months:[],years:[],services:[],groups:{},count:{},cost:{},countCost:{},duration:{},countDuration:{},status:"",avg:{},selectedService:"",selectedGroup:"",userType:!1,colors:["#2f7ed8","#910000","#8bbc21","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a","#0d233a"]}},created:function(){this.getUserTypes()},methods:{changeGroup:function(){""!==this.selectedGroup&&(this.selectedService=""),this.search()},userTypeName:function(e){var t=this.userTypes.find((function(t){return t.t_id===e}));if(t)return t.t_name_fr},draw:function(){switch(this.mode){case"connection":this.drawConnection(),this.drawNewUsers();break;case"services":this.drawServices();break;case"job":this.drawJobs()}},drawHistogram:function(e,t,s,r,i){var a=this.colors;i&&i.colors&&(a=i.colors),n.chart(e,{chart:{type:"column"},title:{text:t,align:"left",style:{color:"#000000",fontSize:"20px",fontWeight:700}},credits:{enabled:!1},colors:a,legend:{labelFormatter:function(){return this.name}},subtitle:{text:""},xAxis:{categories:s,crosshair:!0},yAxis:{min:0,allowDecimals:!1,title:{text:""}},tooltip:{formatter:function(e){var t=0,s="<b>"+this.x.replaceAll("-","/")+"</b><br />";return this.points.forEach((function(e,n){s+='<span style="color: '+e.color+'">●</span> '+r[n].name+": "+e.y+"<br/>",t+=e.y})),s+'<span style="margin-left:10px;font-weight:700">Total: </span>'+t},shared:!0,useHTML:!0},plotOptions:{column:{stacking:"normal",pointPadding:0,borderWidth:1,groupPadding:0,shadow:!1}},series:r})},drawNewUsers:function(){var e=this[this.by+"s"],t=this.newUsers[this.by+"s"],s=[];for(var n in t)s.push({name:this.userTypeName(n),data:t[n]});this.drawHistogram("newUsers","Nouvels utilisateurs",e,s)},drawConnection:function(){var e=this[this.by+"s"],t=this.sessions[this.by+"s"],s=[];for(var n in t)s.push({name:this.userTypeName(n),data:t[n]});this.drawHistogram("sessions","Nombre de connexions",e,s)},drawJobs:function(){var e=this[this.by+"s"],t=this.process[this.by+"s"],s=[],n=[],r="";for(var i in t){if(this.userType)r=this.userTypeName(i);else{var a=this.services.find((function(e){return e.name===i}));r=i,n.push(a.color)}s.push({name:r,data:t[i]})}var o={};n.length>0&&(o={colors:n}),this.drawHistogram("jobs","Nombre de jobs",e,s,o)},getUserTypes:function(){var e=this.appUrl+"/auth/getOrganismTypes";this.$http.get(e).then((function(e){this.initialize(e.body)}))},initialize:function(e){this.by="day",this.startDate=d()().startOf("month").format("YYYY-MM-DD"),this.endDate=d()().endOf("month").format("YYYY-MM-DD"),e.types&&(this.userTypes=e.types),this.search()},jobsAverage:function(){var e=this,t=0,s=0,n=0,r=0,i=0;this.userType?this.userTypes.forEach((function(a){t+=e.count[a.t_id],n+=e.countDuration[a.t_id],s+=e.duration[a.t_id],r+=e.cost[a.t_id],i+=e.countCost[a.t_id]})):this.selectedServices.forEach((function(a){t+=e.count[a.name],n+=e.countDuration[a.name],s+=e.duration[a.name],r+=e.cost[a.name],i+=e.countCost[a.name]})),this.avg={count:t,cost:i>0?Math.round(r/i):0,duration:n>0?Math.round(s/n):0}},secondToStr:function(e){e=Math.round(e);var t=Math.floor(e/86400);e%=86400;var s=Math.floor(e/3600);e%=3600;var n=Math.floor(e/60),r=e%60;return(t>0?t+"j ":"")+s.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")},setMode:function(e){this.mode=e,this.search()},search:function(){if(this.appUrl)switch(this.mode){case"connection":this.searchConnection();break;case"service":this.searchService();break;case"job":this.searchJob();break;case"ciest2":this.searchCiest2()}},searchConnection:function(){var e=this.appUrl+"/statistics/searchSession?",t=[];this.startDate&&t.push("start="+this.startDate),this.endDate&&t.push("end="+this.endDate),e+=t.join("&"),this.$http.get(e).then((function(e){this.treatmentConnection(e.body)}))},searchJob:function(){var e=this.appUrl+"/statistics/searchJobs?",t=[];if(this.startDate&&t.push("start="+this.startDate),this.endDate&&t.push("end="+this.endDate),""!==this.status&&t.push("status="+this.status),""!==this.selectedService)t.push("service="+this.selectedService);else if(""!==this.selectedGroup){var s=this.selectedServices.map((function(e){return e.id}));t.push("service="+s.join(","))}this.userType&&t.push("type=1"),e+=t.join("&"),this.$http.get(e).then((function(e){this.treatmentJobs(e.body)}))},searchService:function(){this.$http.get(this.appUrl+"/statistics/serviceUsers").then((function(e){this.treatmentServices(e.body)}))},searchCiest2:function(){},extractSeriesFrom:function(e,t,s){s&&(this.days=[],this.months=[],this.years=[],this.cost={},this.count={},this.countCost={},this.duration={},this.countDuration={}),this.count[t]=0,this.cost[t]=0,this.countCost[t]=0,this.duration[t]=0,this.countDuration[t]=0;var n=d()(this.startDate,"YYYY-MM-DD"),r={days:[],months:[],years:[]},i=(n=d()(this.startDate,"YYYY-MM-DD"),this),a=n.year(),o=(n.month()+1).toString().padStart(2,"0")+"-"+a,c=null,u=null;s&&(this.years.push(a+""),this.months.push(o));var l=0,v=0;e.forEach((function(e){var p=e.year.toString()+e.month.toString().padStart(2,"0")+e.day.toString().padStart(2,"0"),h=d()(p,"YYYYMMDD");for(c=h.year(),u=(h.month()+1).toString().padStart(2,"0")+"-"+c;h.diff(n,"days")>0;)s&&i.days.push(n.format("DD-MM-YYYY")),r.days.push(0),n.add(1,"days"),c=n.year(),(u=(n.month()+1).toString().padStart(2,"0")+"-"+c)!==o&&(r.months.push(l),s&&i.months.push(u),o=u,l=0),c!==a&&(r.years.push(v),s&&i.years.push(c+""),a=c,v=0);s&&i.days.push(n.format("DD-MM-YYYY")),r.days.push(e.tot),i.count[t]=i.count[t]+e.tot,e.cost&&(i.cost[t]=i.cost[t]+e.cost,i.countCost[t]=i.countCost[t]+e.tot),e.duration&&(i.duration[t]=i.duration[t]+parseInt(e.duration),i.countDuration[t]=i.countDuration[t]+e.tot),l+=e.tot,v+=e.tot,u!==o&&(r.months.push(l),s&&i.months.push(u),o=u,l=0),c!==a&&(r.years.push(v),s&&i.years.push(c+""),a=c,v=0),n=h.add(1,"days")}));for(var p=d()(this.endDate,"YYYY-MM-DD");p.diff(n,"days")>=0;)s&&i.days.push(n.format("DD-MM-YYYY")),r.days.push(0),c=n.year(),(u=(n.month()+1).toString().padStart(2,"0")+"-"+c)!==o&&(r.months.push(l),s&&i.months.push(u),o=u,l=0),c!==a&&(r.years.push(v),s&&i.years.push(c+""),a=c,v=0),n.add(1,"days");return this.years.length>r.years.length&&r.years.push(v),this.months.length>r.months.length&&r.months.push(l),r},treatmentConnection:function(e){var t=this;this.userTypes.forEach((function(s){var n=e.sessions.filter((function(e){return e.type===s.t_id})),r=t.extractSeriesFrom(n,s.t_id,!0);!1,t.sessions.days[s.t_id]=r.days,t.sessions.months[s.t_id]=r.months,t.sessions.years[s.t_id]=r.years})),this.drawConnection(),this.userTypes.forEach((function(s){var n=e.newUsers.filter((function(e){return e.type===s.t_id})),r=t.extractSeriesFrom(n,s.t_id);t.newUsers.days[s.t_id]=r.days,t.newUsers.months[s.t_id]=r.months,t.newUsers.years[s.t_id]=r.years})),this.drawNewUsers()},treatmentJobs:function(e){var t=this;0===this.services.length&&(this.services=e.services,this.services.forEach((function(e){t.groups[e.group]?t.groups[e.group].push(e):t.groups[e.group]=[e]}))),this.process={days:{},months:{},years:{}};var s=!0;this.userType?this.userTypes.forEach((function(n){var r=e.process.filter((function(e){return e.type===n.t_id})),i=t.extractSeriesFrom(r,n.t_id,s);s=!1,t.process.days[n.t_id]=i.days,t.process.months[n.t_id]=i.months,t.process.years[n.t_id]=i.years})):this.selectedServices.forEach((function(n){if(""===t.selectedService||t.selectedService===n.id){var r=e.process.filter((function(e){return e.service===parseInt(n.id)})),i=t.extractSeriesFrom(r,n.name,s);s=!1,t.process.days[n.name]=i.days,t.process.months[n.name]=i.months,t.process.years[n.name]=i.years}})),this.jobsAverage(),this.drawJobs()},treatmentServices:function(e){var t=null,s=[],n={};this.userTypes.forEach((function(e){n[e.t_id]=[]})),e.serviceUsers.forEach((function(r){if(r.service!==t)for(var i in s.push(r.service),t=r.service,n){var a=e.serviceUsers.find((function(e){return e.type===i&&e.service===t}));a?n[i].push(a.tot):n[i].push(0)}}));var r=[];for(var i in n)r.push({name:this.userTypeName(i),data:n[i]});this.drawHistogram("services","Nombre d'utilisateurs par service",s,r)}}},h=(s(334),s(1)),m=Object(h.a)(p,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticStyle:{padding:"10px"}},[s("ul",{staticClass:"menu-content"},[s("li",{staticClass:"{selected: mode === 'connection'}",on:{click:function(t){return e.setMode("connection")}}},[e._v("Connexion\n    ")]),s("li",{staticClass:"{selected: mode === 'service'}",on:{click:function(t){return e.setMode("service")}}},[e._v("Services\n    ")]),s("li",{staticClass:"{selected: mode === 'job'}",on:{click:function(t){return e.setMode("job")}}},[e._v("Jobs\n    ")]),s("li",{staticClass:"{selected: mode === 'ciest2'}",on:{click:function(t){return e.setMode("ciest2")}}},[e._v("CIEST2\n    ")])])]),e._v(" "),s("div",{staticStyle:{"margin-left":"20px"}},["service"!==e.mode?s("div",{staticClass:"user-search",class:{"user-search-large":"job"===e.mode}},[s("label",[e._v("Du")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.startDate,expression:"startDate"}],attrs:{type:"date"},domProps:{value:e.startDate},on:{change:function(t){return e.search()},input:function(t){t.target.composing||(e.startDate=t.target.value)}}}),e._v(" "),s("label",[e._v("au")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.endDate,expression:"endDate"}],attrs:{type:"date"},domProps:{value:e.endDate},on:{change:function(t){return e.search()},input:function(t){t.target.composing||(e.endDate=t.target.value)}}}),e._v(" "),s("label",[e._v("Par")]),e._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.by,expression:"by"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.by=t.target.multiple?s:s[0]},function(t){return e.draw()}]}},[s("option",{attrs:{value:"day"}},[e._v("Jour")]),e._v(" "),s("option",{attrs:{value:"month"}},[e._v("Mois")]),e._v(" "),s("option",{attrs:{value:"year"}},[e._v("Year")])]),e._v(" "),"job"===e.mode?s("span",[s("label",[e._v("Statut")]),e._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.status,expression:"status"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.status=t.target.multiple?s:s[0]},function(t){return e.search()}]}},[s("option",{attrs:{value:""}},[e._v("---")]),e._v(" "),s("option",{attrs:{value:"ended"}},[e._v("Terminé")]),e._v(" "),s("option",{attrs:{value:"success"}},[e._v("Terminé avec succès")]),e._v(" "),s("option",{attrs:{value:"failed"}},[e._v("En échec")]),e._v(" "),s("option",{attrs:{value:"aborted"}},[e._v("Abandonné")])]),e._v(" "),s("label",[e._v("Groupe")]),e._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedGroup,expression:"selectedGroup"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedGroup=t.target.multiple?s:s[0]},function(t){return e.changeGroup()}]}},[s("option",{attrs:{value:""}},[e._v("TOUS")]),e._v(" "),e._l(e.groups,(function(t,n){return s("option",{domProps:{value:n}},[e._v("\n            "+e._s(n)+"\n         ")])}))],2),e._v(" "),s("label",[e._v("Service")]),e._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedService,expression:"selectedService"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedService=t.target.multiple?s:s[0]},function(t){return e.search()}]}},[s("option",{attrs:{value:""}},[e._v("TOUS")]),e._v(" "),e._l(e.selectedServices,(function(t){return s("option",{domProps:{value:t.id}},[e._v("\n            "+e._s(t.name)+"\n         ")])}))],2),e._v(" "),s("label",[e._v("Type utilisateur")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userType,expression:"userType"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.userType)?e._i(e.userType,null)>-1:e.userType},on:{change:[function(t){var s=e.userType,n=t.target,r=!!n.checked;if(Array.isArray(s)){var i=e._i(s,null);n.checked?i<0&&(e.userType=s.concat([null])):i>-1&&(e.userType=s.slice(0,i).concat(s.slice(i+1)))}else e.userType=r},function(t){return e.search()}]}})]):e._e()]):s("div",[e._v("\n  Il ne s'agit pas d'un historique. L'accès aux services d'un utilisateur peut changer au cours du temps et l'information historique n'est pas enregistrée.\n  ")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"connection"===e.mode,expression:"mode === 'connection'"}]},[s("div",{attrs:{id:"sessions"}}),e._v(" "),s("div",{staticStyle:{"margin-top":"30px"},attrs:{id:"newUsers"}})]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"service"===e.mode,expression:"mode === 'service'"}]},[s("div",{staticStyle:{"margin-top":"30px"},attrs:{id:"services"}})]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"job"===e.mode,expression:"mode === 'job'"}],staticClass:"job-content"},[s("h1",[e._v(e._s(e.selectedName))]),e._v(" "),s("div",{staticClass:"job-header"},[s("div",[s("h2",[e._v("Total jobs")]),e._v(" "),e._l(e.userTypes,(function(t,n){return e.userType?s("div",[s("span",{staticClass:"fa fa-circle",style:{color:e.colors[n]}}),e._v(" "),s("b",[e._v(e._s(t.t_name_fr))]),e._v(":\n             "),e.count&&e.count[t.t_id]?s("span",[e._v(e._s(e.count[t.t_id].toLocaleString()))]):s("span",[e._v("0")])]):e._e()})),e._v(" "),e._l(e.selectedServices,(function(t){return e.userType||""!==e.selectedService&&e.selectedService!==t.id?e._e():s("div",[s("span",{staticClass:"fa fa-circle",style:{color:t.color}}),e._v(" "),s("b",[e._v(e._s(t.name))]),e._v(":\n             "),e.count&&e.count[t.name]?s("span",[e._v(e._s(e.count[t.name].toLocaleString()))]):s("span",[e._v("0")])])})),e._v(" "),""===e.selectedService||e.userType?s("hr",{staticStyle:{width:"60%","margin-left":"5px",color:"gray"}}):e._e(),e._v(" "),""===e.selectedService||e.userType?s("div",[s("b",[e._v("Total")]),e._v(": "+e._s(e.avg.count)+"\n           ")]):e._e()],2),e._v(" "),s("div",[s("h2",[e._v("Coût moyen")]),e._v(" "),e._l(e.userTypes,(function(t,n){return e.userType?s("div",[s("span",{staticClass:"fa fa-circle",style:{color:e.colors[n]}}),e._v(" "),s("b",[e._v(e._s(t.t_name_fr))]),e._v(":\n             "),e.cost&&e.cost[t.t_id]?s("span",[e._v(e._s(Math.round(e.cost[t.t_id]/e.countCost[t.t_id]).toLocaleString())+" CPU secondes")]):s("span",[e._v("---")])]):e._e()})),e._v(" "),e._l(e.selectedServices,(function(t){return e.userType||""!==e.selectedService&&e.selectedService!==t.id?e._e():s("div",[s("span",{staticClass:"fa fa-circle",style:{color:t.color}}),e._v(" "),s("b",[e._v(e._s(t.name))]),e._v(":\n             "),e.cost&&e.cost[t.name]?s("span",[e._v(e._s(Math.round(e.cost[t.name]/e.countCost[t.name]).toLocaleString())+" CPU secondes")]):s("span",[e._v("---")])])})),e._v(" "),""===e.selectedService||e.userType?s("hr",{staticStyle:{width:"60%","margin-left":"5px",color:"gray"}}):e._e(),e._v(" "),""===e.selectedService||e.userType?s("div",[e.userType?s("b",[e._v("Tout type")]):s("b",[e._v("Tout service")]),e._v(":\n              "),e.avg&&e.avg.cost?s("span",[e._v(e._s(Math.round(e.avg.cost).toLocaleString())+" CPU Secondes")]):s("span",[e._v("---")])]):e._e()],2),e._v(" "),s("div",[s("h2",[e._v("Durée moyenne")]),e._v(" "),e._l(e.userTypes,(function(t,n){return e.userType?s("div",[s("span",{staticClass:"fa fa-circle",style:{color:e.colors[n]}}),e._v(" "),s("b",[e._v(e._s(t.t_name_fr))]),e._v(":\n             "),"success"===e.status&&e.duration&&e.countDuration[t.t_id]?s("span",[e._v(e._s(e.secondToStr(e.duration[t.t_id]/e.countDuration[t.t_id])))]):s("span",[e._v("---")])]):e._e()})),e._v(" "),e._l(e.selectedServices,(function(t){return e.userType||""!==e.selectedService&&e.selectedService!==t.id?e._e():s("div",[s("span",{staticClass:"fa fa-circle",style:{color:t.color}}),e._v(" "),s("b",[e._v(e._s(t.name))]),e._v(":\n             "),"success"===e.status&&e.duration&&e.countDuration[t.name]?s("span",[e._v(e._s(e.secondToStr(e.duration[t.name]/e.countDuration[t.name])))]):s("span",[e._v("---")])])})),e._v(" "),""===e.selectedService||e.userType?s("hr",{staticStyle:{width:"60%","margin-left":"5px",color:"gray"}}):e._e(),e._v(" "),""===e.selectedService||e.userType?s("div",[e.userType?s("b",[e._v("Tout type")]):s("b",[e._v("Tout service")]),e._v(":\n              "),"success"===e.status&&e.avg.duration?s("span",[e._v(e._s(e.secondToStr(e.avg.duration)))]):s("span",[e._v("---")])]):e._e()],2)]),e._v(" "),s("div",{staticStyle:{"margin-top":"30px"},attrs:{id:"jobs"}})])])])}),[],!1,null,null,null);t.default=m.exports}}]);
//# sourceMappingURL=8.gdm-search-components-vjs.js.map